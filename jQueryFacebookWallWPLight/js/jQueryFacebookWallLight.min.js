(function(){var rsplit=function(string,regex){var result=regex.exec(string),retArr=new Array(),first_idx,last_idx,first_bit;while(result!=null){first_idx=result.index;last_idx=regex.lastIndex;if((first_idx)!=0){first_bit=string.substring(0,first_idx);retArr.push(string.substring(0,first_idx));string=string.slice(first_idx)}retArr.push(result[0]);string=string.slice(result[0].length);result=regex.exec(string)}if(!string==""){retArr.push(string)}return retArr},chop=function(string){return string.substr(0,string.length-1)},extend=function(d,s){for(var n in s){if(s.hasOwnProperty(n)){d[n]=s[n]}}};EJS=function(options){options=typeof options=="string"?{view:options}:options;this.set_options(options);if(options.precompiled){this.template={};this.template.process=options.precompiled;EJS.update(this.name,this);return}if(options.element){if(typeof options.element=="string"){var name=options.element;options.element=document.getElementById(options.element);if(options.element==null){throw name+"does not exist!"}}if(options.element.value){this.text=options.element.value}else{this.text=options.element.innerHTML}this.name=options.element.id;this.type="["}else{if(options.url){options.url=EJS.endExt(options.url,this.extMatch);this.name=this.name?this.name:options.url;var url=options.url;var template=EJS.get(this.name,this.cache);if(template){return template}if(template==EJS.INVALID_PATH){return null}try{this.text=EJS.request(url+(this.cache?"":"?"+Math.random()))}catch(e){}if(this.text==null){throw ({type:"EJS",message:"There is no template at "+url})}}}var template=new EJS.Compiler(this.text,this.type);template.compile(options,this.name);EJS.update(this.name,this);this.template=template};EJS.prototype={render:function(object,extra_helpers){object=object||{};this._extra_helpers=extra_helpers;var v=new EJS.Helpers(object,extra_helpers||{});return this.template.process.call(object,object,v)},update:function(element,options){if(typeof element=="string"){element=document.getElementById(element)}if(options==null){_template=this;return function(object){EJS.prototype.update.call(_template,element,object)}}if(typeof options=="string"){params={};params.url=options;_template=this;params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)};EJS.ajax_request(params)}else{element.innerHTML=this.render(options)}},out:function(){return this.template.out},set_options:function(options){this.type=options.type||EJS.type;this.cache=options.cache!=null?options.cache:EJS.cache;this.text=options.text||null;this.name=options.name||null;this.ext=options.ext||EJS.ext;this.extMatch=new RegExp(this.ext.replace(/\./,"."))}};EJS.endExt=function(path,match){if(!path){return null}match.lastIndex=0;return path+(match.test(path)?"":this.ext)};EJS.Scanner=function(source,left,right){extend(this,{left_delimiter:left+"%",right_delimiter:"%"+right,double_left:left+"%%",double_right:"%%"+right,left_equal:left+"%=",left_comment:left+"%#"});this.SplitRegexp=left=="["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)");this.source=source;this.stag=null;this.lines=0};EJS.Scanner.to_text=function(input){if(input==null||input===undefined){return""}if(input instanceof Date){return input.toDateString()}if(input.toString){return input.toString()}return""};EJS.Scanner.prototype={scan:function(block){scanline=this.scanline;regex=this.SplitRegexp;if(!this.source==""){var source_split=rsplit(this.source,/\n/);for(var i=0;i<source_split.length;i++){var item=source_split[i];this.scanline(item,regex,block)}}},scanline:function(line,regex,block){this.lines++;var line_split=rsplit(line,regex);for(var i=0;i<line_split.length;i++){var token=line_split[i];if(token!=null){try{block(token,this)}catch(e){throw {type:"EJS.Scanner",line:this.lines}}}}}};EJS.Buffer=function(pre_cmd,post_cmd){this.line=new Array();this.script="";this.pre_cmd=pre_cmd;this.post_cmd=post_cmd;for(var i=0;i<this.pre_cmd.length;i++){this.push(pre_cmd[i])}};EJS.Buffer.prototype={push:function(cmd){this.line.push(cmd)},cr:function(){this.script=this.script+this.line.join("; ");this.line=new Array();this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var i=0;i<this.post_cmd.length;i++){this.push(pre_cmd[i])}this.script=this.script+this.line.join("; ");line=null}}};EJS.Compiler=function(source,left){this.pre_cmd=["var ___ViewO = [];"];this.post_cmd=new Array();this.source=" ";if(source!=null){if(typeof source=="string"){source=source.replace(/\r\n/g,"\n");source=source.replace(/\r/g,"\n");this.source=source}else{if(source.innerHTML){this.source=source.innerHTML}}if(typeof this.source!="string"){this.source=""}}left=left||"<";var right=">";switch(left){case"[":right="]";break;case"<":break;default:throw left+" is not a supported deliminator";break}this.scanner=new EJS.Scanner(this.source,left,right);this.out=""};EJS.Compiler.prototype={compile:function(options,name){options=options||{};this.out="";var put_cmd="___ViewO.push(";var insert_cmd=put_cmd;var buff=new EJS.Buffer(this.pre_cmd,this.post_cmd);var content="";var clean=function(content){content=content.replace(/\\/g,"\\\\");content=content.replace(/\n/g,"\\n");content=content.replace(/"/g,'\\"');return content};this.scanner.scan(function(token,scanner){if(scanner.stag==null){switch(token){case"\n":content=content+"\n";buff.push(put_cmd+'"'+clean(content)+'");');buff.cr();content="";break;case scanner.left_delimiter:case scanner.left_equal:case scanner.left_comment:scanner.stag=token;if(content.length>0){buff.push(put_cmd+'"'+clean(content)+'")')}content="";break;case scanner.double_left:content=content+scanner.left_delimiter;break;default:content=content+token;break}}else{switch(token){case scanner.right_delimiter:switch(scanner.stag){case scanner.left_delimiter:if(content[content.length-1]=="\n"){content=chop(content);buff.push(content);buff.cr()}else{buff.push(content)}break;case scanner.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))");break}scanner.stag=null;content="";break;case scanner.double_right:content=content+scanner.right_delimiter;break;default:content=content+token;break}}});if(content.length>0){buff.push(put_cmd+'"'+clean(content)+'")')}buff.close();this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(to_be_evaled)}catch(e){if(typeof JSLINT!="undefined"){JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if(error.reason!="Unnecessary semicolon."){error.line++;var e=new Error();e.lineNumber=error.line;e.message=error.reason;if(options.view){e.fileName=options.view}throw e}}}else{throw e}}}};EJS.config=function(options){EJS.cache=options.cache!=null?options.cache:EJS.cache;EJS.type=options.type!=null?options.type:EJS.type;EJS.ext=options.ext!=null?options.ext:EJS.ext;var templates_directory=EJS.templates_directory||{};EJS.templates_directory=templates_directory;EJS.get=function(path,cache){if(cache==false){return null}if(templates_directory[path]){return templates_directory[path]}return null};EJS.update=function(path,template){if(path==null){return}templates_directory[path]=template};EJS.INVALID_PATH=-1};EJS.config({cache:true,type:"<",ext:".ejs"});EJS.Helpers=function(data,extras){this._data=data;this._extras=extras;extend(this,extras)};EJS.Helpers.prototype={view:function(options,data,helpers){if(!helpers){helpers=this._extras}if(!data){data=this._data}return new EJS(options).render(data,helpers)},to_text:function(input,null_text){if(input==null||input===undefined){return null_text||""}if(input instanceof Date){return input.toDateString()}if(input.toString){return input.toString().replace(/\n/g,"<br />").replace(/''/g,"'")}return""}};EJS.newRequest=function(){var factories=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<factories.length;i++){try{var request=factories[i]();if(request!=null){return request}}catch(e){continue}}};EJS.request=function(path){var request=new EJS.newRequest();request.open("GET",path,false);try{request.send(null)}catch(e){return null}if(request.status==404||request.status==2||(request.status==0&&request.responseText=="")){return null}return request.responseText};EJS.ajax_request=function(params){params.method=(params.method?params.method:"GET");var request=new EJS.newRequest();request.onreadystatechange=function(){if(request.readyState==4){if(request.status==200){params.onComplete(request)}else{params.onComplete(request)}}};request.open(params.method,params.url);request.send(null)}})();(function(a){a.fn.validationEngineLanguage=function(){};a.validationEngineLanguage={newLang:function(){a.validationEngineLanguage.allRules={required:{regex:"none",alertText:"* This field is required",alertTextCheckboxMultiple:"* Please select an option",alertTextCheckboxe:"* This checkbox is required",alertTextDateRange:"* Both date range fields are required"},dateRange:{regex:"none",alertText:"* Invalid ",alertText2:"Date Range"},dateTimeRange:{regex:"none",alertText:"* Invalid ",alertText2:"Date Time Range"},minSize:{regex:"none",alertText:"* Minimum ",alertText2:" characters allowed"},maxSize:{regex:"none",alertText:"* Maximum ",alertText2:" characters allowed"},groupRequired:{regex:"none",alertText:"* You must fill one of the following fields"},min:{regex:"none",alertText:"* Minimum value is "},max:{regex:"none",alertText:"* Maximum value is "},past:{regex:"none",alertText:"* Date prior to "},future:{regex:"none",alertText:"* Date past "},maxCheckbox:{regex:"none",alertText:"* Maximum ",alertText2:" options allowed"},minCheckbox:{regex:"none",alertText:"* Please select ",alertText2:" options"},equals:{regex:"none",alertText:"* Fields do not match"},creditCard:{regex:"none",alertText:"* Invalid credit card number"},phone:{regex:/^([\+][0-9]{1,3}[\ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9\ \.\-\/]{3,20})((x|ext|extension)[\ ]?[0-9]{1,4})?$/,alertText:"* Invalid phone number"},email:{regex:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,alertText:"* Invalid email address"},integer:{regex:/^[\-\+]?\d+$/,alertText:"* Not a valid integer"},number:{regex:/^[\-\+]?(([0-9]+)([\.,]([0-9]+))?|([\.,]([0-9]+))?)$/,alertText:"* Invalid floating decimal number"},date:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/,alertText:"* Invalid date, must be in YYYY-MM-DD format"},ipv4:{regex:/^((([01]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))[.]){3}(([0-1]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))$/,alertText:"* Invalid IP address"},url:{regex:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,alertText:"* Invalid URL"},onlyNumberSp:{regex:/^[0-9\ ]+$/,alertText:"* Numbers only"},onlyLetterSp:{regex:/^[a-zA-Z\ \']+$/,alertText:"* Letters only"},onlyLetterNumber:{regex:/^[0-9a-zA-Z]+$/,alertText:"* No special characters allowed"},ajaxUserCall:{url:"ajaxValidateFieldUser",extraData:"name=eric",alertText:"* This user is already taken",alertTextLoad:"* Validating, please wait"},ajaxUserCallPhp:{url:"phpajax/ajaxValidateFieldUser.php",extraData:"name=eric",alertTextOk:"* This username is available",alertText:"* This user is already taken",alertTextLoad:"* Validating, please wait"},ajaxNameCall:{url:"ajaxValidateFieldName",alertText:"* This name is already taken",alertTextOk:"* This name is available",alertTextLoad:"* Validating, please wait"},ajaxNameCallPhp:{url:"phpajax/ajaxValidateFieldName.php",alertText:"* This name is already taken",alertTextLoad:"* Validating, please wait"},validate2fields:{alertText:"* Please input HELLO"},dateFormat:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/,alertText:"* Invalid Date"},dateTimeFormat:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/,alertText:"* Invalid Date or Date Format",alertText2:"Expected Format: ",alertText3:"mm/dd/yyyy hh:mm:ss AM|PM or ",alertText4:"yyyy-mm-dd hh:mm:ss AM|PM"}}}};a.validationEngineLanguage.newLang()})(jQuery);(function(b){var a={init:function(c){var d=this;if(!d.data("jqv")||d.data("jqv")==null){c=a._saveOptions(d,c);b(".formError").live("click",function(){b(this).fadeOut(150,function(){b(this).parent(".formErrorOuter").remove();b(this).remove()})})}return this},attach:function(e){if(!b(this).is("form")){alert("Sorry, jqv.attach() only applies to a form");return this}var d=this;var c;if(e){c=a._saveOptions(d,e)}else{c=d.data("jqv")}c.validateAttribute=(d.find("[data-validation-engine*=validate]").length)?"data-validation-engine":"class";if(c.binded){d.find("["+c.validateAttribute+"*=validate]").not("[type=checkbox]").not("[type=radio]").not(".datepicker").bind(c.validationEventTrigger,a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][type=checkbox],["+c.validateAttribute+"*=validate][type=radio]").bind("click",a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][class*=datepicker]").bind(c.validationEventTrigger,{delay:300},a._onFieldEvent)}if(c.autoPositionUpdate){b(window).bind("resize",{noAnimation:true,formElem:d},a.updatePromptsPosition)}d.bind("submit",a._onSubmitEvent);return this},detach:function(){if(!b(this).is("form")){alert("Sorry, jqv.detach() only applies to a form");return this}var d=this;var c=d.data("jqv");d.find("["+c.validateAttribute+"*=validate]").not("[type=checkbox]").unbind(c.validationEventTrigger,a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][type=checkbox],[class*=validate][type=radio]").unbind("click",a._onFieldEvent);d.unbind("submit",a.onAjaxFormComplete);d.find("["+c.validateAttribute+"*=validate]").not("[type=checkbox]").die(c.validationEventTrigger,a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][type=checkbox]").die("click",a._onFieldEvent);d.die("submit",a.onAjaxFormComplete);d.removeData("jqv");if(c.autoPositionUpdate){b(window).unbind("resize",a.updatePromptsPosition)}return this},validate:function(){if(b(this).is("form")){return a._validateFields(this)}else{var e=b(this).closest("form");var c=e.data("jqv");var d=a._validateField(b(this),c);if(c.onSuccess&&c.InvalidFields.length==0){c.onSuccess()}else{if(c.onFailure&&c.InvalidFields.length>0){c.onFailure()}}return d}},updatePromptsPosition:function(f){if(f&&this==window){var e=f.data.formElem;var c=f.data.noAnimation}else{var e=b(this.closest("form"))}var d=e.data("jqv");e.find("["+d.validateAttribute+"*=validate]").not(":hidden").not(":disabled").each(function(){var i=b(this);var g=a._getPrompt(i);var h=b(g).find(".formErrorContent").html();if(g){a._updatePrompt(i,b(g),h,undefined,false,d,c)}});return this},showPrompt:function(d,f,h,e){var g=this.closest("form");var c=g.data("jqv");if(!c){c=a._saveOptions(this,c)}if(h){c.promptPosition=h}c.showArrow=e==true;a._showPrompt(this,d,f,false,c);return this},hide:function(){var e=b(this).closest("form");if(e.length==0){return this}var d=e.data("jqv");var c;if(b(this).is("form")){c="parentForm"+a._getClassName(b(this).attr("id"))}else{c=a._getClassName(b(this).attr("id"))+"formError"}b("."+c).fadeTo(d.fadeDuration,0.3,function(){b(this).parent(".formErrorOuter").remove();b(this).remove()});return this},hideAll:function(){var d=this;var c=d.data("jqv");var e=c?c.fadeDuration:0.3;b(".formError").fadeTo(e,0.3,function(){b(this).parent(".formErrorOuter").remove();b(this).remove()});return this},_onFieldEvent:function(e){var f=b(this);var d=f.closest("form");var c=d.data("jqv");window.setTimeout(function(){a._validateField(f,c);if(c.InvalidFields.length==0&&c.onSuccess){c.onSuccess()}else{if(c.InvalidFields.length>0&&c.onFailure){c.onFailure()}}},(e.data)?e.data.delay:0)},_onSubmitEvent:function(){var e=b(this);var c=e.data("jqv");var d=a._validateFields(e,c.ajaxFormValidation);if(d&&c.ajaxFormValidation){a._validateFormWithAjax(e,c);return false}if(c.onValidationComplete){c.onValidationComplete(e,d);return false}return d},_checkAjaxStatus:function(d){var c=true;b.each(d.ajaxValidCache,function(e,f){if(!f){c=false;return false}});return c},_validateFields:function(e,m){var n=e.data("jqv");var f=false;e.trigger("jqv.form.validating");var o=null;e.find("["+n.validateAttribute+"*=validate]").not(":hidden").not(":disabled").each(function(){var q=b(this);var p=[];if(b.inArray(q.attr("name"),p)<0){f|=a._validateField(q,n,m);if(f&&o==null){o=q}if(n.doNotShowAllErrosOnSubmit){return false}p.push(q.attr("name"))}});e.trigger("jqv.form.result",[f]);if(f){if(n.scroll){var l=o.offset().top;var h=o.offset().left;var j=n.promptPosition;if(typeof(j)=="string"&&j.indexOf(":")!=-1){j=j.substring(0,j.indexOf(":"))}if(j!="bottomRight"&&j!="bottomLeft"){var i=a._getPrompt(o);l=i.offset().top}if(n.isOverflown){var c=b(n.overflownDIV);if(!c.length){return false}var d=c.scrollTop();var g=-parseInt(c.offset().top);l+=d+g-5;var k=b(n.overflownDIV+":not(:animated)");k.animate({scrollTop:l},1100,function(){if(n.focusFirstField){o.focus()}})}else{b("html:not(:animated),body:not(:animated)").animate({scrollTop:l,scrollLeft:h},1100,function(){if(n.focusFirstField){o.focus()}})}}else{if(n.focusFirstField){o.focus()}}return false}return true},_validateFormWithAjax:function(e,d){var f=e.serialize();var c=(d.ajaxFormValidationURL)?d.ajaxFormValidationURL:e.attr("action");b.ajax({type:d.ajaxFormValidationMethod,url:c,cache:false,dataType:"json",data:f,form:e,methods:a,options:d,beforeSend:function(){return d.onBeforeAjaxFormValidation(e,d)},error:function(g,h){a._ajaxError(g,h)},success:function(l){if(l!==true){var j=false;for(var k=0;k<l.length;k++){var m=l[k];var o=m[0];var h=b(b("#"+o)[0]);if(h.length==1){var n=m[2];if(m[1]==true){if(n==""||!n){a._closePrompt(h)}else{if(d.allrules[n]){var g=d.allrules[n].alertTextOk;if(g){n=g}}a._showPrompt(h,n,"pass",false,d,true)}}else{j|=true;if(d.allrules[n]){var g=d.allrules[n].alertText;if(g){n=g}}a._showPrompt(h,n,"",false,d,true)}}}d.onAjaxFormComplete(!j,e,l,d)}else{d.onAjaxFormComplete(true,e,"",d)}}})},_validateField:function(c,k,p){if(!c.attr("id")){c.attr("id","form-validation-field-"+b.validationEngine.fieldIdCounter);++b.validationEngine.fieldIdCounter}var r=c.attr(k.validateAttribute);var v=/validate\[(.*)\]/.exec(r);if(!v){return false}var s=v[1];var o=s.split(/\[|,|\]/);var l=false;var h=c.attr("name");var g="";var q=false;k.isError=false;k.showArrow=true;var d=b(c.closest("form"));for(var u=0;u<o.length;u++){o[u]=o[u].replace(" ","");var e=undefined;switch(o[u]){case"required":q=true;e=a._required(c,o,u,k);break;case"custom":e=a._customRegex(c,o,u,k);break;case"groupRequired":var t="["+k.validateAttribute+"*="+o[u+1]+"]";var f=d.find(t).eq(0);if(f[0]!=c[0]){a._validateField(f,k,p);k.showArrow=true;continue}e=a._groupRequired(c,o,u,k);if(e){q=true}k.showArrow=false;break;case"ajax":if(!p){a._ajax(c,o,u,k);l=true}break;case"minSize":e=a._minSize(c,o,u,k);break;case"maxSize":e=a._maxSize(c,o,u,k);break;case"min":e=a._min(c,o,u,k);break;case"max":e=a._max(c,o,u,k);break;case"past":e=a._past(c,o,u,k);break;case"future":e=a._future(c,o,u,k);break;case"dateRange":var t="["+k.validateAttribute+"*="+o[u+1]+"]";var f=d.find(t).eq(0);var j=d.find(t).eq(1);if(f[0].value||j[0].value){e=a._dateRange(f,j,o,u,k)}if(e){q=true}k.showArrow=false;break;case"dateTimeRange":var t="["+k.validateAttribute+"*="+o[u+1]+"]";var f=d.find(t).eq(0);var j=d.find(t).eq(1);if(f[0].value||j[0].value){e=a._dateTimeRange(f,j,o,u,k)}if(e){q=true}k.showArrow=false;break;case"maxCheckbox":e=a._maxCheckbox(d,c,o,u,k);c=b(d.find("input[name='"+h+"']"));break;case"minCheckbox":e=a._minCheckbox(d,c,o,u,k);c=b(d.find("input[name='"+h+"']"));break;case"equals":e=a._equals(c,o,u,k);break;case"funcCall":e=a._funcCall(c,o,u,k);break;case"creditCard":e=a._creditCard(c,o,u,k);break;default:}if(e!==undefined){g+=e+"<br/>";k.isError=true}}if(!q&&c.val()==""){k.isError=false}var m=c.prop("type");if((m=="radio"||m=="checkbox")&&d.find("input[name='"+h+"']").size()>1){c=b(d.find("input[name='"+h+"'][type!=hidden]:first"));k.showArrow=false}if(k.isError){a._showPrompt(c,g,"",false,k)}else{if(!l){a._closePrompt(c)}}if(!l){c.trigger("jqv.field.result",[c,k.isError,g])}var n=b.inArray(c[0],k.InvalidFields);if(n==-1){if(k.isError){k.InvalidFields.push(c[0])}}else{if(!k.isError){k.InvalidFields.splice(n,1)}}return k.isError},_required:function(g,h,e,d){switch(g.prop("type")){case"text":case"password":case"textarea":case"file":default:if(!b.trim(g.val())||g.val()==g.attr("data-validation-placeholder")){return d.allrules[h[e]].alertText}break;case"radio":case"checkbox":var f=g.closest("form");var c=g.attr("name");if(f.find("input[name='"+c+"']:checked").size()==0){if(f.find("input[name='"+c+"']").size()==1){return d.allrules[h[e]].alertTextCheckboxe}else{return d.allrules[h[e]].alertTextCheckboxMultiple}}break;case"select-one":if(!g.val()){return d.allrules[h[e]].alertText}break;case"select-multiple":if(!g.find("option:selected").val()){return d.allrules[h[e]].alertText}}},_groupRequired:function(f,h,d,c){var g="["+c.validateAttribute+"*="+h[d+1]+"]";var e=false;f.closest("form").find(g).each(function(){if(!a._required(b(this),h,d,c)){e=true;return false}});if(!e){return c.allrules[h[d]].alertText}},_customRegex:function(j,k,f,d){var c=k[f+1];var h=d.allrules[c];if(!h){alert("jqv:custom rule not found "+c);return}var e=h.regex;if(!e){alert("jqv:custom regex not found "+c);return}var g=new RegExp(e);if(!g.test(j.val())){return d.allrules[c].alertText}},_funcCall:function(j,k,d,c){var h=k[d+1];var f;if(h.indexOf(".")>-1){var g=h.split(".");var e=window;while(g.length){e=e[g.shift()]}f=e}else{f=window[h]||c.customFunctions[h]}if(typeof(f)=="function"){return f(j,k,d,c)}},_equals:function(f,g,e,d){var c=g[e+1];if(f.val()!=b("#"+c).val()){return d.allrules.equals.alertText}},_maxSize:function(h,j,f,e){var d=j[f+1];var c=h.val().length;if(c>d){var g=e.allrules.maxSize;return g.alertText+d+g.alertText2}},_minSize:function(h,j,f,d){var e=j[f+1];var c=h.val().length;if(c<e){var g=d.allrules.minSize;return g.alertText+e+g.alertText2}},_min:function(h,j,f,d){var e=parseFloat(j[f+1]);var c=parseFloat(h.val());if(c<e){var g=d.allrules.min;if(g.alertText2){return g.alertText+e+g.alertText2}return g.alertText+e}},_max:function(h,j,f,e){var d=parseFloat(j[f+1]);var c=parseFloat(h.val());if(c>d){var g=e.allrules.max;if(g.alertText2){return g.alertText+d+g.alertText2}return g.alertText+d}},_past:function(j,k,e,c){var h=k[e+1];var d=(h.toLowerCase()=="now")?new Date():a._parseDate(h);var f=a._parseDate(j.val());if(f>d){var g=c.allrules.past;if(g.alertText2){return g.alertText+a._dateToString(d)+g.alertText2}return g.alertText+a._dateToString(d)}},_future:function(j,k,e,c){var h=k[e+1];var d=(h.toLowerCase()=="now")?new Date():a._parseDate(h);var f=a._parseDate(j.val());if(f<d){var g=c.allrules.future;if(g.alertText2){return g.alertText+a._dateToString(d)+g.alertText2}return g.alertText+a._dateToString(d)}},_isDate:function(d){var c=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/);return c.test(d)},_isDateTime:function(d){var c=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/);return c.test(d)},_dateCompare:function(d,c){return(new Date(d.toString())<new Date(c.toString()))},_dateRange:function(g,d,f,e,c){if((!g[0].value&&d[0].value)||(g[0].value&&!d[0].value)){return c.allrules[f[e]].alertText+c.allrules[f[e]].alertText2}if(!a._isDate(g[0].value)||!a._isDate(d[0].value)){return c.allrules[f[e]].alertText+c.allrules[f[e]].alertText2}if(!a._dateCompare(g[0].value,d[0].value)){return c.allrules[f[e]].alertText+c.allrules[f[e]].alertText2}},_dateTimeRange:function(g,d,f,e,c){if((!g[0].value&&d[0].value)||(g[0].value&&!d[0].value)){return c.allrules[f[e]].alertText+c.allrules[f[e]].alertText2}if(!a._isDateTime(g[0].value)||!a._isDateTime(d[0].value)){return c.allrules[f[e]].alertText+c.allrules[f[e]].alertText2}if(!a._dateCompare(g[0].value,d[0].value)){return c.allrules[f[e]].alertText+c.allrules[f[e]].alertText2}},_maxCheckbox:function(h,j,k,g,f){var d=k[g+1];var e=j.attr("name");var c=h.find("input[name='"+e+"']:checked").size();if(c>d){f.showArrow=false;if(f.allrules.maxCheckbox.alertText2){return f.allrules.maxCheckbox.alertText+" "+d+" "+f.allrules.maxCheckbox.alertText2}return f.allrules.maxCheckbox.alertText}},_minCheckbox:function(h,j,k,g,f){var d=k[g+1];var e=j.attr("name");var c=h.find("input[name='"+e+"']:checked").size();if(c<d){f.showArrow=false;return f.allrules.minCheckbox.alertText+" "+d+" "+f.allrules.minCheckbox.alertText2}},_creditCard:function(k,l,f,n){var d=false,m=k.val().replace(/ +/g,"").replace(/-+/g,"");var c=m.length;if(c>=14&&c<=16&&parseInt(m)>0){var g=0,f=c-1,j=1,h,e=new String();do{h=parseInt(m.charAt(f));e+=(j++%2==0)?h*2:h}while(--f>=0);for(f=0;f<e.length;f++){g+=parseInt(e.charAt(f))}d=g%10==0}if(!d){return n.allrules.creditCard.alertText}},_ajax:function(m,o,h,p){var n=o[h+1];var l=p.allrules[n];var e=l.extraData;var j=l.extraDataDynamic;if(!e){e=""}if(j){var g=[];var k=String(j).split(",");for(var h=0;h<k.length;h++){var c=k[h];if(b(c).length){var d=m.closest("form").find(c).val();var f=c.replace("#","")+"="+escape(d);g.push(f)}}j=g.join("&")}else{j=""}if(!p.isError){b.ajax({type:p.ajaxFormValidationMethod,url:l.url,cache:false,dataType:"json",data:"fieldId="+m.attr("id")+"&fieldValue="+m.val()+"&extraData="+e+"&"+j,field:m,rule:l,methods:a,options:p,beforeSend:function(){var i=l.alertTextLoad;if(i){a._showPrompt(m,i,"load",true,p)}},error:function(i,q){a._ajaxError(i,q)},success:function(s){var u=s[0];var r=b(b("input[id='"+u+"']")[0]);if(r.length==1){var q=s[1];var t=s[2];if(!q){p.ajaxValidCache[u]=false;p.isError=true;if(t){if(p.allrules[t]){var i=p.allrules[t].alertText;if(i){t=i}}}else{t=l.alertText}a._showPrompt(r,t,"",true,p)}else{if(p.ajaxValidCache[u]!==undefined){p.ajaxValidCache[u]=true}if(t){if(p.allrules[t]){var i=p.allrules[t].alertTextOk;if(i){t=i}}}else{t=l.alertTextOk}if(t){a._showPrompt(r,t,"pass",true,p)}else{a._closePrompt(r)}}}r.trigger("jqv.field.result",[r,p.isError,t])}})}},_ajaxError:function(c,d){if(c.status==0&&d==null){alert("The page is not served from a server! ajax call failed")}else{if(typeof console!="undefined"){console.log("Ajax error: "+c.status+" "+d)}}},_dateToString:function(c){return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()},_parseDate:function(e){var c=e.split("-");if(c==e){c=e.split("/")}return new Date(c[0],(c[1]-1),c[2])},_showPrompt:function(i,g,h,f,e,d){var c=a._getPrompt(i);if(d){c=false}if(c){a._updatePrompt(i,c,g,h,f,e)}else{a._buildPrompt(i,g,h,f,e)}},_buildPrompt:function(h,c,f,j,k){var d=b("<div>");d.addClass(a._getClassName(h.attr("id"))+"formError");if(h.is(":input")){d.addClass("parentForm"+a._getClassName(h.parents("form").attr("id")))}d.addClass("formError");switch(f){case"pass":d.addClass("greenPopup");break;case"load":d.addClass("blackPopup");break;default:}if(j){d.addClass("ajaxed")}var l=b("<div>").addClass("formErrorContent").html(c).appendTo(d);if(k.showArrow){var i=b("<div>").addClass("formErrorArrow");var e=h.data("promptPosition")||k.promptPosition;if(typeof(e)=="string"){var g=e.indexOf(":");if(g!=-1){e=e.substring(0,g)}}switch(e){case"bottomLeft":case"bottomRight":d.find(".formErrorContent").before(i);i.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":i.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');d.append(i);break}}if(h.closest(".ui-dialog").length){d.addClass("formErrorInsideDialog")}d.css({opacity:0,position:"absolute"});h.before(d);var g=a._calculatePosition(h,d,k);d.css({top:g.callerTopPosition,left:g.callerleftPosition,marginTop:g.marginTopSize,opacity:0}).data("callerField",h);if(k.autoHidePrompt){setTimeout(function(){d.animate({opacity:0},function(){d.closest(".formErrorOuter").remove();d.remove()})},k.autoHideDelay)}return d.animate({opacity:0.87})},_updatePrompt:function(i,d,c,g,j,k,e){if(d){if(typeof g!=="undefined"){if(g=="pass"){d.addClass("greenPopup")}else{d.removeClass("greenPopup")}if(g=="load"){d.addClass("blackPopup")}else{d.removeClass("blackPopup")}}if(j){d.addClass("ajaxed")}else{d.removeClass("ajaxed")}d.find(".formErrorContent").html(c);var h=a._calculatePosition(i,d,k);var f={top:h.callerTopPosition,left:h.callerleftPosition,marginTop:h.marginTopSize};if(e){d.css(f)}else{d.animate(f)}}},_closePrompt:function(d){var c=a._getPrompt(d);if(c){c.fadeTo("fast",0,function(){c.parent(".formErrorOuter").remove();c.remove()})}},closePrompt:function(c){return a._closePrompt(c)},_getPrompt:function(e){var f=b(e).closest("form").attr("id");var d=a._getClassName(e.attr("id"))+"formError";var c=b("."+a._escapeExpression(d)+".parentForm"+f)[0];if(c){return b(c)}},_escapeExpression:function(c){return c.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},isRTL:function(e){var f=b(document);var c=b("body");var d=(e&&e.hasClass("rtl"))||(e&&(e.attr("dir")||"").toLowerCase()==="rtl")||f.hasClass("rtl")||(f.attr("dir")||"").toLowerCase()==="rtl"||c.hasClass("rtl")||(c.attr("dir")||"").toLowerCase()==="rtl";return Boolean(d)},_calculatePosition:function(m,f,r){var e,n,k;var g=m.width();var c=m.position().left;var p=m.position().top;var d=m.height();var q=f.height();e=n=0;k=-q;var j=m.data("promptPosition")||r.promptPosition;var i="";var h="";var o=0;var l=0;if(typeof(j)=="string"){if(j.indexOf(":")!=-1){i=j.substring(j.indexOf(":")+1);j=j.substring(0,j.indexOf(":"));if(i.indexOf(",")!=-1){h=i.substring(i.indexOf(",")+1);i=i.substring(0,i.indexOf(","));l=parseInt(h);if(isNaN(l)){l=0}}o=parseInt(i);if(isNaN(i)){i=0}}}switch(j){default:case"topRight":n+=c+g-30;e+=p;break;case"topLeft":e+=p;n+=c;break;case"centerRight":e=p+4;k=0;n=c+m.outerWidth(1)+5;break;case"centerLeft":n=c-(f.width()+2);e=p+4;k=0;break;case"bottomLeft":e=p+m.height()+5;k=0;n=c;break;case"bottomRight":n=c+g-30;e=p+m.height()+5;k=0}n+=o;e+=l;return{callerTopPosition:e+"px",callerleftPosition:n+"px",marginTopSize:k+"px"}},_saveOptions:function(e,d){if(b.validationEngineLanguage){var c=b.validationEngineLanguage.allRules}else{b.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page")}b.validationEngine.defaults.allrules=c;var f=b.extend(true,{},b.validationEngine.defaults,d);e.data("jqv",f);return f},_getClassName:function(c){if(c){return c.replace(/:/g,"_").replace(/\./g,"_")}}};b.fn.validationEngine=function(d){var c=b(this);if(!c[0]){return false}if(typeof(d)=="string"&&d.charAt(0)!="_"&&a[d]){if(d!="showPrompt"&&d!="hide"&&d!="hideAll"){a.init.apply(c)}return a[d].apply(c,Array.prototype.slice.call(arguments,1))}else{if(typeof d=="object"||!d){a.init.apply(c,arguments);return a.attach.apply(c)}else{b.error("Method "+d+" does not exist in jQuery.validationEngine")}}};b.validationEngine={fieldIdCounter:0,defaults:{validationEventTrigger:"blur",scroll:true,focusFirstField:true,promptPosition:"topRight",bindMethod:"bind",inlineAjax:false,ajaxFormValidation:false,ajaxFormValidationURL:false,ajaxFormValidationMethod:"get",onAjaxFormComplete:b.noop,onBeforeAjaxFormValidation:b.noop,onValidationComplete:false,doNotShowAllErrosOnSubmit:false,binded:true,showArrow:true,isError:false,ajaxValidCache:{},autoPositionUpdate:false,InvalidFields:[],onSuccess:false,onFailure:false,autoHidePrompt:false,autoHideDelay:10000,fadeDuration:0.3}};b(function(){b.validationEngine.defaults.promptPosition=a.isRTL()?"topLeft":"topRight"})})(jQuery);
/*!
 * jQuery Facebook Wall Plugin
 * @author: Lorenzo Gangi lorenzo@ironlasso.com
 * @license: see /licensing/readme_license.txt
 * @copyright
 * @version 1.0
 */
(function(i){i.support.cors=true;var f={appId:false,domain:false,installDirectory:"/jQueryFacebookWallLight/",facebookUser:false,display:"timeline",language:"english",posts:{show:true,feedType:"feed",limit:10,order:5},debug:false};var m={};var e={init:function(r){return this.each(function(){m=i(this);var v=f;m.options=i.extend(true,v,r);if(m.options.appId&&m.options.domain){k()}else{alert("Error: Your appId or domain is not defined in your plugin declaration..")}var u=m.data("jQueryFacebookWallLight");if(!u){i(this).data("jQueryFacebookWallLight",{target:m,options:m.options,feed:false,currentUser:{},app:{},fbUserInfo:{},photosData:{}})}jQFWlanguage.language=m.options.language;EJS.Helpers.prototype.localize=function(w){return jQFWlanguage.localize(w)};m.addClass("facebook-wall wall facebook-wall-clearfix");if(m.options.display==="timeline"){m.removeClass("wall");m.addClass("timeline")}if(m.options.display==="single-column"){m.removeClass("wall");m.addClass("single-column")}var s=navigator.userAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/);if(s){var t=s[0].split(" ")[0];if(t){if(parseFloat(s[1])<8){m.addClass("fbw-ie7")}else{if(parseFloat(s[1])<9){m.addClass("fbw-ie8")}}}}m.append('<div class="fbw-wall-loading fbw-big-loading " />');m.append(i('<div class="fbw-left-column" />'));if(m.options.display!="single-column"){m.append(i('<div class="fbw-right-column" />'))}m.jQueryFacebookWallLight("loadFbData");m.delegate("click.jQueryFacebookWallLight",{temp:"this is some temp data"},e.testmethodclick);m.on("click.jQueryFacebookWallLight",".jfw-lightbox-link",function(A){var z="<div>lightbox content</div>";var y=i(A.currentTarget);if(y.hasClass("album-cover-photo-wrapper")){y.append('<div class="fbw-loading positioned"></div>');var C=y.data("albumData");if(C.photos==undefined){var B="https://graph.facebook.com/"+C.id+"/?access_token="+m.data("jQueryFacebookWallLight").app.appToken+"&fields=photos.fields(name,source,created_time,comments.fields(created_time,from,message,like_count))&callback=?";i.getJSON(B,function(D){i.each(D.photos.data,function(){this.created_time=h(this.created_time);if(this.comments){i.each(this.comments.data,function(){this.created_time=b(this.created_time)})}});i.extend(C,D);i.extend(C,{facebookUser:m.data("jQueryFacebookWallLight").fbUserInfo,templatePath:m.options.installDirectory});m.data("jQueryFacebookWallLight").fbUserInfo;z=new EJS({url:m.options.installDirectory+"templates/photoGallery.ejs"}).render(C);y.find(".fbw-loading").remove();_popLightBox(z)})}else{i.extend(C,{templatePath:m.options.installDirectory});z=new EJS({url:m.options.installDirectory+"templates/photoGallery.ejs"}).render(C);y.find(".fbw-loading").remove();_popLightBox(z)}}else{if(y.hasClass("photo-cover-photo-wrapper")){y.append('<div class="fbw-loading positioned"></div>');var w=m.data("jQueryFacebookWallLight").photosData;i.extend(w,{startingIndex:y.attr("data-index"),templatePath:m.options.installDirectory});z=new EJS({url:m.options.installDirectory+"templates/photoGallery.ejs"}).render(w);y.find(".fbw-loading").remove();_popLightBox(z)}}});m.on("click.jQueryFacebookWallLight",".user-interaction-like",function(y){$target=i(y.target);var w=$target.closest(".story").attr("data-id");q(w,$target)})})},destroy:function(){return this.each(function(){var s=i(this);var r=s.data("jQueryFacebookWallLight");r.target.unbind(".jQueryFacebookWallLight");s.removeData("jQueryFacebookWallLight");s.remove()})},testmethodclick:function(r){console.log("test click");console.log(r.data.temp)},loadFbData:function(){if(!m.data("jQueryFacebookWallLight").app.appToken){i.getJSON(m.options.installDirectory+"fb_app_token.html",function(r){m.data("jQueryFacebookWallLight").app.appToken=r.appToken;c()})}else{c()}}};function p(s){if(m.options.debug){d("_buildFbWall: feed data",s)}var r=m.find(".fbw-left-column");if(m.options.display=="single-column"){$rightColumn=m.find(".fbw-left-column")}else{$rightColumn=m.find(".fbw-right-column")}var t=0;var u=0;var w=0;var v=0;$rightColumn.find(".story").each(function(){v+=i(this).height()});i.each(s.data,function(){if(m.options.debug){console.log("_buildwall: feed data - post:");console.log(this)}var B=this;var D=B.comments;B.created_time=b(B.created_time);if(B.likes){B.likes.count=n(B.likes.count)}if(B.message){B.message=g(B.message)}if(m.data("jQueryFacebookWallLight").options.display==="timeline"){if(B.picture!==undefined){B.picture=B.picture.substring(0,B.picture.length-5)+"n.png"}}if(B.comments){B.comments.count=D.data.length}var z=new EJS({url:m.options.installDirectory+"templates/story.ejs"}).render(B);if(B.message){var C="";if(m.options.display=="timeline"){if(w<v){r.append(z);C=r.find(".story").last();y(B);var A=r.find(".story").last().find(".story-picture").width();w+=r.find(".story").last().height()+A}else{$rightColumn.append(z);C=$rightColumn.find(".story").last();C.find(".timeline-pointer-left").removeClass("timeline-pointer-left").addClass("timeline-pointer-right");y(B);var A=$rightColumn.find(".story").last().find(".story-picture").width();v+=C.height()+A}}else{r.append(z);C=r.find(".story").last();y(B)}}function y(G){if(G.comments){if(m.options.debug){d("_buildFbWall: adding Comments",D)}i.each(D.data,function(){this.created_time=b(this.created_time)});D.showAtStart=3;var E=new EJS({url:m.options.installDirectory+"templates/comments.ejs"}).render(D);$commentStats=C.find(".comment-stats");$commentCountCurrent=$commentStats.find(".comment-count-current");if(G.comments.data.length<3){$commentCountCurrent.text(D.data.length);$commentStats.find(".comments-view-more a").addClass("hide")}else{$commentCountCurrent.text(3)}}var F=m.find(".story[data-id="+G.id+"] .comments");F.append(E);if(G.comments&&D.paging.next){F.data("commentsNextPage",D.paging.next)}}})}function l(){var r=m.find(".fbw-left-column");if(m.options.display=="single-column"){$rightColumn=m.find(".fbw-left-column")}else{$rightColumn=m.find(".fbw-right-column")}r.css("visibility","visible");$rightColumn.css("visibility","visible");i(".fbw-wall-loading").fadeOut()}function d(s,t,r){if(r!=undefined){console.log("jQuery Facebook Wall ERROR-------")}else{console.log("DEBUG MESSAGE--------------------")}console.log(s);console.log(t);console.log("---------------------------------")}function c(){var t=[];var s=[null,null,null,null,null,null];var r=[];var z="https://graph.facebook.com/"+m.options.facebookUser+"/?access_token="+m.data("jQueryFacebookWallLight").app.appToken+"&callback=?";t[0]=i.getJSON(z);s[0]=w;r[0]="fbUserInfo";var v=1;if(m.options.posts.show){var y="https://graph.facebook.com/"+m.options.facebookUser+"/"+m.options.posts.feedType+"/?access_token="+m.data("jQueryFacebookWallLight").app.appToken+"&fields=id,comments.limit(3).fields(id,created_time,like_count,from,message),status_type,picture, full_picture, source, properties, name, caption, description, link, from,message,story,likes.summary(true),object_id,shares&limit=5&callback=?";t.push(i.getJSON(y));if(s[m.options.posts.order]){v=0}s.splice(m.options.posts.order,v,u);r.push("feed")}s.push(function(){l()});i.when.apply(i,t).done(s).fail(function(A){if(m.options.debug){d("_getFbData: failed to retrieve facebook data",A)}});function u(B){var A=i.inArray("feed",r);p(arguments[A][0])}function w(A){m.data("jQueryFacebookWallLight").fbUserInfo=arguments[0][0]}}function g(r){var s=/(\b(http?|https):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;return r.replace(s,"<a href='$1'>$1</a>")}function q(u,t){var s=a();if(s){if(m.options.debug){console.log("_userInteractionLike: posting a like")}var y=t.hasClass("liked");var r="post";var w=jQFWlanguage.localize("Unlike");var v=1;if(y){r="delete";w="Like";v=-1}FB.api("/"+u+"/likes",r,function(A){if(!A||A.error){if(m.options.debug){console.log("_userInteractionLike: ERROR posting like, response error:");console.log(A.error)}}else{if(m.options.debug){console.log("_userInteractionLike: like posted, response:");console.log(A)}if(!y){t.addClass("liked")}if(t.hasClass("user-interaction-comment-like")){t.text(w);var z=t.parent().find(".comment-like-count");z.text(n((z.text().replace(",","")*1)+v))}else{t.text(w);$storyContent=t.closest(".story-content");var z=$storyContent.find(".story-comment-count");z.text(n((z.text().replace(",","")*1)+v));if(!y){if(z.text()==1){$storyContent.find(".story-stats .you-like").text("You ")}$storyContent.find(".story-stats").removeClass("hide");z.prev().show()}else{z.prev().hide()}}}})}}function a(){var r=false;FB.getLoginStatus(function(s){if(s.status==="connected"){if(m.options.debug){console.log("_fbAuthenticate: user authenticated:");console.log(s)}r=true;j()}else{if(s.status==="not_authorized"){o()}else{o()}}});return r}function k(){var r={appId:m.options.appId*1,channelUrl:"//"+m.options.domain,status:true,cookie:true,xfbml:true};if(typeof FB!=="undefined"){FB._initialized=false;FB.init(r);return}window.fbAsyncInit=function(){FB.init(r)};(function(u){var t,v="facebook-jssdk",s=u.getElementsByTagName("script")[0];if(u.getElementById(v)){return}t=u.createElement("script");t.id=v;t.async=true;t.src="//connect.facebook.net/en_US/all.js";s.parentNode.insertBefore(t,s)}(document))}function o(){FB.login(function(r){if(r.authResponse){if(m.options.debug){console.log("_fbLogin: user authenticated:");console.log(r)}}else{}},{scope:"publish_actions, publish_stream, user_likes"})}function j(){FB.api("/me",function(r){if(m.options.debug){console.log("_fbGetUserData: retrieved user data:");console.log(r)}m.data("jQueryFacebookWallLight").currentUser.id=r.id;m.data("jQueryFacebookWallLight").currentUser.name=r.name})}function b(u){var s=new Date(u),t=(((new Date()).getTime()-s.getTime())/1000),r=Math.floor(t/86400);if(isNaN(r)||r<0||r>=31){return}return r==0&&(t<60&&jQFWlanguage.localize("just now")||t<120&&jQFWlanguage.localize("1 minute ago")||t<3600&&Math.floor(t/60)+jQFWlanguage.localize(" minutes ago")||t<7200&&jQFWlanguage.localize("1 hour ago")||t<86400&&Math.floor(t/3600)+jQFWlanguage.localize(" hours ago"))||r==1&&jQFWlanguage.localize("Yesterday")||r<7&&r+jQFWlanguage.localize(" days ago")||r<31&&Math.ceil(r/7)+jQFWlanguage.localize(" weeks ago")}function n(s){s+="";x=s.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var r=/(\d+)(\d{3})/;while(r.test(x1)){x1=x1.replace(r,"$1,$2")}return x1+x2}function h(t){var s=new Date(t);if(!s.getMonth()){t=t.split(/[-T.]/);var s=new Date(t[0]+"/"+t[1]+"/"+t[2]+" "+t[3])}var w=new Array(7);w[0]=jQFWlanguage.localize("Sunday");w[1]=jQFWlanguage.localize("Monday");w[2]=jQFWlanguage.localize("Tuesday");w[3]=jQFWlanguage.localize("Wednesday");w[4]=jQFWlanguage.localize("Thursday");w[5]=jQFWlanguage.localize("Friday");w[6]=jQFWlanguage.localize("Saturday");var v=w[s.getDay()];var y=new Array();y[0]=jQFWlanguage.localize("January");y[1]=jQFWlanguage.localize("February");y[2]=jQFWlanguage.localize("March");y[3]=jQFWlanguage.localize("April");y[4]=jQFWlanguage.localize("May");y[5]=jQFWlanguage.localize("June");y[6]=jQFWlanguage.localize("July");y[7]=jQFWlanguage.localize("August");y[8]=jQFWlanguage.localize("September");y[9]=jQFWlanguage.localize("October");y[10]=jQFWlanguage.localize("November");y[11]=jQFWlanguage.localize("December");var z=y[s.getMonth()];var r=s.getDate();var y=s.getMonth();var u=s.getFullYear();return v+" "+z+" "+r+" "+u}i.fn.jQueryFacebookWallLight=function(r){if(e[r]){return e[r].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof r==="object"||!r){return e.init.apply(this,arguments)}else{i.error("Method "+r+" does not exist on jQuery.jQueryFacebookWallLight")}}}})(jQuery);var jQFWlanguage={language:"english",localize:function(a){if(this.language==="english"){return a}else{return this.viewText[this.language][a]}},viewText:{}};EJS.Helpers.prototype.date_tag=function(c,q,a){if(!(q instanceof Date)){q=new Date()}var b=["January","February","March","April","May","June","July","August","September","October","November","December"];var h=[],e=[],r=[];var k=q.getFullYear();var i=q.getMonth();var p=q.getDate();for(var o=k-15;o<k+15;o++){h.push({value:o,text:o})}for(var f=0;f<12;f++){e.push({value:(f),text:b[f]})}for(var j=0;j<31;j++){r.push({value:(j+1),text:(j+1)})}var n=this.select_tag(c+"[year]",k,h,{id:c+"[year]"});var g=this.select_tag(c+"[month]",i,e,{id:c+"[month]"});var l=this.select_tag(c+"[day]",p,r,{id:c+"[day]"});return n+g+l};EJS.Helpers.prototype.form_tag=function(b,a){a=a||{};a.action=b;if(a.multipart==true){a.method="post";a.enctype="multipart/form-data"}return this.start_tag_for("form",a)};EJS.Helpers.prototype.form_tag_end=function(){return this.tag_end("form")};EJS.Helpers.prototype.hidden_field_tag=function(a,c,b){return this.input_field_tag(a,c,"hidden",b)};EJS.Helpers.prototype.input_field_tag=function(a,d,c,b){b=b||{};b.id=b.id||a;b.value=d||"";b.type=c||"text";b.name=a;return this.single_tag_for("input",b)};EJS.Helpers.prototype.is_current_page=function(a){return(window.location.href==a||window.location.pathname==a?true:false)};EJS.Helpers.prototype.link_to=function(b,a,c){if(!b){var b="null"}if(!c){var c={}}if(c.confirm){c.onclick=' var ret_confirm = confirm("'+c.confirm+'"); if(!ret_confirm){ return false;} ';c.confirm=null}c.href=a;return this.start_tag_for("a",c)+b+this.tag_end("a")};EJS.Helpers.prototype.submit_link_to=function(b,a,c){if(!b){var b="null"}if(!c){var c={}}c.onclick=c.onclick||"";if(c.confirm){c.onclick=' var ret_confirm = confirm("'+c.confirm+'"); if(!ret_confirm){ return false;} ';c.confirm=null}c.value=b;c.type="submit";c.onclick=c.onclick+(a?this.url_for(a):"")+"return false;";return this.start_tag_for("input",c)};EJS.Helpers.prototype.link_to_if=function(f,b,a,d,c,e){return this.link_to_unless((f==false),b,a,d,c,e)};EJS.Helpers.prototype.link_to_unless=function(e,b,a,c,d){c=c||{};if(e){if(d&&typeof d=="function"){return d(b,a,c,d)}else{return b}}else{return this.link_to(b,a,c)}};EJS.Helpers.prototype.link_to_unless_current=function(b,a,c,d){c=c||{};return this.link_to_unless(this.is_current_page(a),b,a,c,d)};EJS.Helpers.prototype.password_field_tag=function(a,c,b){return this.input_field_tag(a,c,"password",b)};EJS.Helpers.prototype.select_tag=function(d,g,h,f){f=f||{};f.id=f.id||d;f.value=g;f.name=d;var b="";b+=this.start_tag_for("select",f);for(var e=0;e<h.length;e++){var c=h[e];var a={value:c.value};if(c.value==g){a.selected="selected"}b+=this.start_tag_for("option",a)+c.text+this.tag_end("option")}b+=this.tag_end("select");return b};EJS.Helpers.prototype.single_tag_for=function(a,b){return this.tag(a,b,"/>")};EJS.Helpers.prototype.start_tag_for=function(a,b){return this.tag(a,b)};EJS.Helpers.prototype.submit_tag=function(a,b){b=b||{};b.type=b.type||"submit";b.value=a||"Submit";return this.single_tag_for("input",b)};EJS.Helpers.prototype.tag=function(c,e,d){if(!d){var d=">"}var b=" ";for(var a in e){if(e[a]!=null){var f=e[a].toString()}else{var f=""}if(a=="Class"){a="class"}if(f.indexOf("'")!=-1){b+=a+'="'+f+'" '}else{b+=a+"='"+f+"' "}}return"<"+c+b+d};EJS.Helpers.prototype.tag_end=function(a){return"</"+a+">"};EJS.Helpers.prototype.text_area_tag=function(a,c,b){b=b||{};b.id=b.id||a;b.name=b.name||a;c=c||"";if(b.size){b.cols=b.size.split("x")[0];b.rows=b.size.split("x")[1];delete b.size}b.cols=b.cols||50;b.rows=b.rows||4;return this.start_tag_for("textarea",b)+c+this.tag_end("textarea")};EJS.Helpers.prototype.text_tag=EJS.Helpers.prototype.text_area_tag;EJS.Helpers.prototype.text_field_tag=function(a,c,b){return this.input_field_tag(a,c,"text",b)};EJS.Helpers.prototype.url_for=function(a){return'window.location="'+a+'";'};EJS.Helpers.prototype.img_tag=function(b,c,a){a=a||{};a.src=b;a.alt=c;return this.single_tag_for("img",a)};